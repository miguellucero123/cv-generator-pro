name: Project Validation

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Check commit messages
        run: |
          echo "✅ Checking project structure"

          # Verificar que existan las carpetas principales
          if [ -d "cv-generator-backend" ]; then
            echo "✅ Backend folder exists"
          else
            echo "❌ Backend folder missing"
            exit 1
          fi

          if [ -d "metgo3d-cv-generator" ]; then
            echo "✅ Frontend folder exists"
          else
            echo "❌ Frontend folder missing"
            exit 1
          fi

          # Verificar archivos críticos
          if [ -f "cv-generator-backend/package.json" ]; then
            echo "✅ Backend package.json exists"
          else
            echo "❌ Backend package.json missing"
            exit 1
          fi

          if [ -f "metgo3d-cv-generator/package.json" ]; then
            echo "✅ Frontend package.json exists"
          else
            echo "❌ Frontend package.json missing"
            exit 1
          fi

      - name: Markdown lint
        uses: nosborn/github-action-markdown-cli@v3.2.0
        with:
          files: .
          config_file: ".markdownlint.json"
        continue-on-error: true

      - name: Check for secrets
        uses: trufflesecurity/trufflehog@main
        continue-on-error: true
        with:
          path: ./
          base: ${{ github.event.repository.default_branch }}
          head: HEAD

      - name: Report Status
        if: always()
        run: |
          echo "## ✅ Project Validation Summary" >> $GITHUB_STEP_SUMMARY
          echo "- Structure: ✅" >> $GITHUB_STEP_SUMMARY
          echo "- Files: ✅" >> $GITHUB_STEP_SUMMARY
